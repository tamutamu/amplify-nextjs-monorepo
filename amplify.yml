version: 1
applications:
  - appRoot: frontend/app
    frontend:
      phases:
        preBuild:
          commands:
            - cd ../../
            - yarn install
        build:
          commands:
            - cd frontend/app
            - rm -rf .next
            - rm -rf out
            - yarn build
      artifacts:
        baseDirectory: out
        files:
          - "**/*"
      cache:
        paths:
          - ../../node_modules
          - ./node_modules
  - appRoot: backend
    backend:
      phases:
        build:
          commands:
            - "# Execute Amplify CLI with the helper script"
            - amplifyPush --simple
    frontend:
      phases:
        build:
          commands:
            - mkdir out
            - echo "<html></html>" > out/index.html
      artifacts:
        baseDirectory: out
        files:
          - "**/*"
      cache:
        paths:
          - ../../node_modules
          - ./node_modules
          - .next/cache/**/*
